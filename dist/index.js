import"dotenv/config";import{makeWASocket as m,useMultiFileAuthState as l}from"@whiskeysockets/baileys";var n=class{constructor(){this.sock=null}async initialize(){let{state:e,saveCreds:s}=await l("auth_info");return this.sock=m({printQRInTerminal:!0,auth:e,syncFullHistory:!1}),this.sock.ev.on("creds.update",s),this.sock}async sendMessage(e,s){await this.sock.sendPresenceUpdate("composing",e),await this.sock.sendMessage(e,{text:s})}};import{GoogleGenerativeAI as u}from"@google/generative-ai";var a=class{constructor(e,s){this.genAI=new u(e,{baseURL:"https://generativelanguage.googleapis.com/v1beta"}),this.model=this.genAI.getGenerativeModel({model:"gemini-2.0-flash"}),this.prompt=`Voc\xEA \xE9 um assistente de vendas. Siga EXATAMENTE este script:1. Sauda\xE7\xE3o inicial
2. Pedir identifica\xE7\xE3o
3. Oferecer produtos (1-\u26A15G R$10, 2-\u{1F341} R$15, 3-\u{1F9C0} R$20, 4-\u{1F344} R$25)
4. Definir zona de entrega (Oeste R$15, Norte R$30, Sul R$50)
5. Coletar endere\xE7o
6. Op\xE7\xF5es de pagamento (Pix, Dinheiro, Cart\xE3o+10%)
7. Confirmar pedido"
${s}`,this.chatHistory=new Map}async createChatSession(e){this.chatHistory.has(e)||this.chatHistory.set(e,[{role:"user",parts:[{text:this.prompt}]}]);let s=this.chatHistory.get(e);return s.length>20&&s.shift(),s}async generateResponse(e,s){let t=await this.createChatSession(e);t.push({role:"user",parts:[{text:s}]});try{let r=(await this.model.generateContent({contents:t})).response.text();if(!r||r.includes("$P$G")||r.trim()==="")throw new Error("Resposta inv\xE1lida recebida do modelo.");return t.push({role:"model",parts:[{text:r}]}),r}catch(o){return console.error("Erro ao gerar resposta:",o.message),"Desculpe, ocorreu um erro ao processar sua solicita\xE7\xE3o. Tente novamente mais tarde."}}};import g from"openai";var i=class{constructor(e,s){this.openai=new g({apiKey:e}),this.prompt=s,this.sessions=new Map}async generateResponse(e,s){this.sessions.has(e)||this.sessions.set(e,[]);let t=[{role:"system",content:this.prompt},...this.sessions.get(e),{role:"user",content:s}],o=await this.openai.chat.completions.create({model:"gpt-4",messages:t});return this.sessions.get(e).push({role:"user",content:s},{role:"assistant",content:o.choices[0].message.content}),o.choices[0].message.content}};var h=class{constructor(){this.whatsapp=new n,this.ai=process.env.AI_SELECTED==="GPT"?new i(process.env.OPENAI_KEY,process.env.PROMPT):new a(process.env.GEMINI_KEY,process.env.PROMPT)}async start(){(await this.whatsapp.initialize()).ev.on("messages.upsert",async({messages:s})=>{let t=s[0];if(!t.message||t.key.fromMe)return;let o=t.key.remoteJid,r=t.message.conversation||t.message.extendedTextMessage?.text;try{let p=await this.ai.generateResponse(o,r);await this.whatsapp.sendMessage(o,p)}catch(p){console.error("Erro:",p),await this.whatsapp.sendMessage(o,"\u274C Ocorreu um erro, tente novamente.")}})}};new h().start();
